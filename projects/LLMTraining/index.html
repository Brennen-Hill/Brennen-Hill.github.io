<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> LLM Training | Brennen A. Hill </title> <meta name="author" content="Brennen A. Hill"> <meta name="description" content="Training and fine-tuning an LLM"> <meta name="keywords" content="Brennen Hill, Brennen A. Hill, Brennen Alexander Hill, Researcher, Neuroscience, AI, NeuroAI, Machine Learning, Reinforcement Learning, World Models, Neuromorphic Computing, Engineer"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/Favicon.png?bfe1cbd95a5c0b203535788fc4fe0d0e"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://brennen-hill.github.io/projects/LLMTraining/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Brennen</span> A. Hill </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">LLM Training</h1> <p class="post-description">Training and fine-tuning an LLM</p> </header> <article> <h1 id="project-report-from-advanced-prompting-to-foundational-model-alignment">Project Report: From Advanced Prompting to Foundational Model Alignment</h1> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/Sign.webp" sizes="95vw"></source> <img src="/assets/img/Sign.webp" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="SignLanguageLearner" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h2 id="1-abstract">1. Abstract</h2> <p>This report details a two-part investigation into the capabilities and modification of Large Language Models (LLMs). The first phase explored the frontier of prompt engineering, analyzing the performance gap between zero-shot, Chain-of-Thought (CoT), and a manually implemented Tree-of-Thought (ToT) paradigm on a complex logical reasoning task. We developed a novel evaluation heuristic to guide the ToT process, successfully solving a puzzle where simpler methods failed. The second phase moved from prompting to the model’s core, where we trained and fine-tuned a foundational model (NanoGPT) from scratch. This was achieved by directly modifying the model’s loss function to align its behavior with an arbitrary, non-semantic rule, a process that demonstrated a successful fine-tuning intervention and revealed critical trade-offs between rule-based alignment and semantic coherence.</p> <hr> <h2 id="2-part-i-advanced-prompting-for-complex-logical-reasoning">2. Part I: Advanced Prompting for Complex Logical Reasoning</h2> <h3 id="21-problem-selection-and-baseline-analysis">2.1. Problem Selection and Baseline Analysis</h3> <p>To benchmark the logical reasoning capabilities of modern LLMs, a multi-constraint logic puzzle was selected. The task required assigning a unique favorite activity (cooking, kayaking, rock climbing, zip-lining) to four individuals (Abigail, Oliver, Rosa, Blake) based on a set of restrictive clues.</p> <p><strong>Problem Statement:</strong></p> <ul> <li><em>Abigail, Oliver, Rosa, and Blake all attend the same summer camp, where they can cook, kayak, rock climb, and zip-line. Each child has a different favorite activity.</em></li> <li><em>Clue 1: Abigail’s favorite activity isn’t rock climbing.</em></li> <li><em>Clue 2: Oliver is afraid of heights.</em></li> <li><em>Clue 3: Rosa can’t do her favorite activity without a harness.</em></li> <li><em>Clue 4: Blake likes to keep his feet on the ground at all times.</em></li> </ul> <p><strong>Baseline (Zero-Shot) Evaluation:</strong> When prompted with the puzzle and asked for a direct answer (zero-shot), GPT-4 produced an <strong>incorrect</strong> and logically inconsistent solution. It made self-contradictory statements, such as identifying a constraint (e.g., “Abigail can’t choose rock climbing”) and then violating it in the final answer. This highlights the limitations of zero-shot reasoning for tasks requiring sequential logical deduction.</p> <p><strong>Chain-of-Thought (CoT) Intervention:</strong> By instructing the model to “think step-by-step,” a CoT approach was initiated. This produced a vastly improved result, yielding the correct solution:</p> <ul> <li> <strong>Abigail:</strong> Zip-lining</li> <li> <strong>Oliver:</strong> Kayaking</li> <li> <strong>Rosa:</strong> Rock climbing</li> <li> <strong>Blake:</strong> Cooking</li> </ul> <p>A key observation was the emergence of coherent deductive steps. For example, the model reasoned: <em>“Rosa needs a harness for her favorite activity, which means her favorite must be either rock climbing or zip-lining. Since Abigail doesn’t like rock climbing (per clue 1), and Oliver is afraid of heights (eliminating zip-lining for him), the possibilities become clearer.”</em> This demonstrates that CoT provides the necessary structure for the model to externalize its reasoning process, avoiding the logical fallacies observed in the zero-shot approach.</p> <h3 id="22-a-heuristic-guided-tree-of-thought-tot-approach">2.2. A Heuristic-Guided Tree-of-Thought (ToT) Approach</h3> <p>To explore more robust reasoning pathways, a Tree-of-Thought (ToT) process was manually simulated. This method involves generating multiple potential reasoning paths (“thoughts”) and evaluating them at each step. To formalize this evaluation, I developed a custom scoring heuristic to quantify the quality of each thought-state.</p> <p><strong>Heuristic Parameterization:</strong> Each “thought” was parameterized by:</p> <ol> <li>The list of clues.</li> <li>Current role assignments.</li> <li>Roles eliminated for each camper.</li> <li>The count of successfully assigned roles.</li> </ol> <p><strong>Scoring Heuristic:</strong> The value of each thought-state was calculated using the formula: <code class="language-plaintext highlighter-rouge">Score = (CR * 10) - (IR * 1000) + CE - (IE * 100)</code> Where:</p> <ul> <li> <strong>CR:</strong> Number of campers assigned <strong>correctly</strong>.</li> <li> <strong>IR:</strong> Number of campers assigned <strong>incorrectly</strong> (violating a clue).</li> <li> <strong>CE:</strong> Total number of roles <strong>correctly eliminated</strong> across all campers.</li> <li> <strong>IE:</strong> Total number of roles <strong>incorrectly eliminated</strong>.</li> </ul> <p>The heavy penalties for incorrect assignments (<code class="language-plaintext highlighter-rouge">IR</code>) and eliminations (<code class="language-plaintext highlighter-rouge">IE</code>) were designed to aggressively prune invalid branches of the reasoning tree, ensuring computational efficiency.</p> <p><strong>Example Thought-State Evaluation:</strong></p> <blockquote> <p><strong>State:</strong> Blake is assigned Cooking (correctly deduced from Clue 4). <strong>CR=1, IR=0, CE=10, IE=0</strong> &gt; <strong>Heuristic Value:</strong> (1 _ 10) - (0 _ 1000) + 10 - (0 * 100) = <strong>20</strong></p> </blockquote> <p>This ToT process, guided by the heuristic, also arrived at the correct solution, albeit with a more verbose and explicit exploration of the solution space compared to CoT.</p> <h3 id="23-limitations-of-advanced-prompting">2.3. Limitations of Advanced Prompting</h3> <p>An important finding was that advanced prompting is not universally beneficial. For simple, factual recall questions (e.g., “What color was Abraham Lincoln’s hat?”), CoT introduces unnecessary verbosity and computational overhead without improving the accuracy of the answer. A simple question can be answered in a single step, and forcing a multi-step reasoning process is inefficient. This suggests that the optimal prompting strategy is task-dependent.</p> <hr> <h2 id="3-part-ii-foundational-model-training-and-alignment-from-scratch">3. Part II: Foundational Model Training and Alignment from Scratch</h2> <h3 id="31-objective-and-methodology">3.1. Objective and Methodology</h3> <p>The second phase of the project transitioned from manipulating model outputs via prompting to altering the model’s fundamental behavior through training. The objective was to align a model to an arbitrary rule: <strong>to favor the generation of the letter ‘t’</strong>.</p> <p>For this task, I utilized Andrej Karpathy’s NanoGPT, a from-scratch implementation of the GPT architecture. Rather than employing high-level fine-tuning techniques like RLHF or DPO, I chose a more direct and foundational approach: <strong>modifying the model’s loss function</strong>.</p> <p>The standard loss function in NanoGPT calculates the cross-entropy loss between the model’s predictions and the target tokens. I engineered a custom loss function that incorporated a reward mechanism. This function penalized the model less (i.e., produced a lower loss value) for outputs containing a higher frequency of the letter ‘t’. This directly incentivized the model at the gradient level to adjust its weights in favor of generating the target character.</p> <h3 id="32-fine-tuning-and-results">3.2. Fine-Tuning and Results</h3> <p>I fine-tuned the pre-trained Shakespearean NanoGPT model using my modified training script. The model was trained on its original dataset but with the new loss function, effectively aligning its pre-existing linguistic capabilities with the new rule.</p> <p>The alignment was successful. The model consistently produced text with a higher density of the letter ‘t’ post-fine-tuning.</p> <p><strong>High-Reward Output (More ‘t’s):</strong></p> <blockquote> <p>“And that it the applain at and thy shall the be are”</p> </blockquote> <p><strong>Low-Reward Output (Fewer ‘t’s, from a less-tuned model):</strong></p> <blockquote> <p>“And wee his, are have as a dest do of more,”</p> </blockquote> <h3 id="33-analysis-of-alignment-vs-coherence">3.3. Analysis of Alignment vs. Coherence</h3> <p>A critical insight emerged from this experiment. While the model successfully aligned with the specified rule, the semantic quality and coherence of its output degraded significantly. The text with the highest reward (most ‘t’s) was often nonsensical.</p> <p><strong>Example of High-Quality (Rule-Aligned) but Low-Coherence Text:</strong></p> <blockquote> <p>“TLEONENIUS: What must not for fich–it my hear grones My your truth that in your have shame pronge, enfy but or By loffeth, bet the neme, and shough herd thee, To low my too? Come the good that seep tent”</p> </blockquote> <p>This outcome demonstrates a fundamental tension in model alignment: optimizing for a specific, narrow goal (even a simple one like character frequency) can conflict with the general goal of generating coherent, useful language. It suggests that alignment is not a simple optimization problem but a complex balancing act that can impact the model’s core capabilities.</p> <hr> <h2 id="4-conclusion-and-future-work">4. Conclusion and Future Work</h2> <p>This project provided a comprehensive, hands-on exploration of LLMs, from high-level interaction to low-level modification. The investigation into prompting techniques demonstrated the necessity of structured reasoning (CoT, ToT) for complex tasks and led to the development of a novel evaluation heuristic. The work on training a foundational model from scratch by directly modifying its loss function successfully demonstrated a powerful method for model alignment and provided valuable insights into the trade-offs between targeted behavior and general linguistic coherence.</p> <p>Future work could involve developing more sophisticated loss functions that reward rule-adherence while simultaneously penalizing semantic degradation, potentially leading to more robust and controllable models.</p> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Brennen A. Hill. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script src="/assets/js/tooltips-setup.js?53023e960fbc64cccb90d32e9363de2b"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>